# âš™ï¸ Install, Setup, Configure â€“ Google Pollen Forecaster
### _Driver for Hubitat_

## ğŸ”¢ Version
**Document Version:** 0.10 (Draft)
**Date:** 2025-12-8  
**Managing Author:** David Ball-Quenneville  
**Associate Author:** ChatGPT and Gemini

## ğŸ“‘ Table of Contents
<details>
<summary>Click to expand Table of Contents</summary>

- ğŸ§­ [Overview](#overview)
- â¬‡ï¸ [Installation](#installation)
- ğŸ› ï¸ [Setup](#setup)
- âš–ï¸ [Configuration](#configuration)
  - â¡ï¸ [Commands](#commands)
    - ğŸ§® [Poll](#polling-button)
  - ğŸ›ï¸ [Preferences](#preferences)
    - ğŸ”‘ [Google Pollen API Key](#google-pollen-api-key)
    - â° [Primary Daily Poll](#primary-daily-poll)
    - â° [Secondary Daily Poll](#secondary-daily-poll)
    - ğŸ›‘ [Max API Calls Per Day](#max-api-calls-per-day)
    - ğŸ—ºï¸ [Use Custom Coordinates](#use-custom-coordinates)
    - ğŸš« [Use Blockout Dates?](#use-blockout-dates)
- ğŸ“ [Summary](#summary)
- ğŸ›¡ï¸ [Disclaimers](#disclaimers)
- ğŸ”— [Reference / External Links](#reference--external-links)
- ğŸ“œ [Revision History](#revision-history)

</details>

---

## ğŸ§­ Overview

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

---

## â¬‡ï¸ Installation

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

---

## ğŸ› ï¸ Setup

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

---

## âš–ï¸ Configuration

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

### â¡ï¸ Commands

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

#### ğŸ§® Polling (Button)

> **Description:** Immediately forces a manual request to the Google Pollen API to fetch the very latest forecast data.

##### ğŸ¯ Purpose and Use
This command is primarily used to:
* **Manually Force an Update:** Bypass the regular scheduled polling intervals to retrieve new data immediately.
* **Troubleshoot:** Quickly test the API key and location settings to verify connectivity.

##### ğŸ“Œ Options and Parameters
| Parameter | Description | Valid Options |
| :--- | :--- | :--- |
| **(None)** | This command is designed for manual execution and accepts no additional parameters. | N/A |

##### ğŸ’¡ Hints and Best Practices
* **API Call Consumption:** Because the driver does **not** check a data cache before execution, clicking the **Poll** button will **always** consume one API call from your daily quota. Use this command sparingly.
* **Blockout Constraint:** If the `Use Blockout Dates?` preference is enabled in **Preferences** and the current date/time falls within a blockout period, the poll will be prevented.
* **Blockout Feedback:** If the poll is blocked, you will see a message in your Hubitat Logs (`Logs` tab), and the device's `apiStatus` attribute will change to **Blockout** until the blockout period ends.

---

### ğŸ›ï¸ Preferences

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

#### ğŸ”‘ Google Pollen API Key

> **Description:** The unique security key provided by Google Cloud, which authenticates your Hubitat driver and authorizes data access to the Google Pollen API.

##### ğŸ¯ Purpose and Use
This is a **mandatory prerequisite** for the driver. Without a valid API key, the driver cannot establish a connection, request, or receive *any* pollen forecast data. This field is the sole requirement for securing access to the Google API service.

##### ğŸ“Œ Options and Values
| Field Type | Value Range | Default Value |
| :--- | :--- | :--- |
| **Text Input** | Full alphanumeric string provided by Google Cloud | (Empty) |

* **Note:** The key must be entered exactly as generated by Google Cloud.

##### ğŸ’¡ Hints and Best Practices
* **Mandatory Field:** This field must be filled out for the driver to function.
* **Security:** Treat your API key as a password. It should never be shared publicly (e.g., in forum posts or shared screenshots), as it is linked directly to your Google Cloud billing account and quota.
* **Activation:** Ensure that the Google Pollen API service is enabled within your Google Cloud project for the provided key to be valid.

#### â° Primary Daily Poll

> **Description:** Sets the mandatory, optimal time each day for the driver to attempt to fetch the latest Google Pollen Forecast data. This is the primary attempt to capture the new daily forecast data as soon as it is released.

##### ğŸ¯ Purpose and Use
This setting is crucial for ensuring your device receives the newest daily forecast data as early as possible. It is intended to run at a time when the new forecast is typically available from the Google API, ensuring data freshness for the entire day.

##### ğŸ“Œ Options and Values
| Field Type | Value Range | Default Value |
| :--- | :--- | :--- |
| **Time Selector** | Hour, Minute, AM/PM Pick List | 6:00 AM |

* **Example:** Setting this to **6:00 AM** means the driver will schedule its main daily retrieval job for 6:00 AM every morning.

##### ğŸ’¡ Hints and Best Practices
* **Required Field:** This is a required field, as the forecast data release is daily.
* **API Impact:** This setting guarantees **one API call per day** (at the specified time) dedicated to fetching the new daily forecast.
* **Timing:** The default of 6:00 AM is recommended as it balances early retrieval with typical hub schedules.

#### â° Secondary Daily Poll

> **Description:** Sets a backup time each day for the driver to attempt to fetch the latest Google Pollen Forecast data. This is a fail-safe to ensure the new forecast data is captured if the Primary Daily Poll fails.

##### ğŸ¯ Purpose and Use
This setting is essential for **driver reliability** and is used to:
* **Backup:** Act as a catch-all if the Primary Daily Poll failed due to a temporary network blip, an API delay, or if the Hubitat hub was briefly offline during the primary scheduled time.
* **Guarantee:** Ensure that regardless of temporary failures, the new daily forecast is captured later in the morning.

##### ğŸ“Œ Options and Values
| Field Type | Value Range | Default Value |
| :--- | :--- | :--- |
| **Time Selector** | Hour, Minute, AM/PM Pick List | 10:00 AM |

* **Example:** Setting this to **10:00 AM** means the driver will schedule its backup retrieval job four hours after the default Primary Poll.

##### ğŸ’¡ Hints and Best Practices
* **Required Field:** This is a required field to maintain daily reliability.
* **API Impact:** This setting guarantees a **second API call per day** (at the specified time). Together, the Primary and Secondary polls ensure two dedicated API calls per 24 hours for the new forecast.
* **Spacing:** It is strongly recommended to set the Secondary Poll time **3 to 4 hours after** the Primary Poll time to allow enough time for transient issues to resolve.

#### ğŸ›‘ Max API Calls Per Day

> **Description:** Defines the maximum number of times the driver is permitted to communicate with the Google Pollen API within a 24-hour window (midnight to midnight UTC/Hub time). This limit applies to all scheduled and manual poll attempts.

##### ğŸ¯ Purpose and Use
This setting is essential for proactive cost and quota management. It is designed to:
* **Prevent Overages:** Ensure you do not accidentally exceed your free-tier or paid quota with Google Cloud by enforcing a strict daily limit.
* **Disable Manual Polling:** Automatically disable the **Poll (Button)** once the limit is reached, regardless of whether a scheduled poll still exists.

##### ğŸ“Œ Options and Values
| Field Type | Value Range | Default Value |
| :--- | :--- | :--- |
| **Number Input** | 1 to 100+ (or as defined by API Quota) | 20 |

* **Note:** The minimum required value is 2 (for the Primary and Secondary Daily Polls to complete).

##### ğŸ’¡ Hints and Best Practices
* **Optimization:** The default of 20 is suitable for initial testing. Once configuration and testing are complete, it is strongly recommended to **lower this value** (e.g., to 2 or 3) to minimize API usage and potential billing.
* **Daily Reset:** The call count automatically resets to zero at the beginning of the next 24-hour period.
* **Driver Feedback:** If you attempt to poll manually after the limit is exceeded, the device's **`apiStatus`** attribute will update to indicate that the daily maximum poll limit has been reached, preventing further attempts until the reset time.
* **API Impact:** Every execution of a Primary, Secondary, or Manual poll counts as one consumption against this limit.

#### ğŸ—ºï¸ Use Custom Coordinates

> **Description:** A toggle that determines the source of the geographical coordinates used for fetching the pollen forecast. When **Off**, the driver uses the location data pre-configured in your Hubitat Hub settings. When **On**, it allows for the entry of custom latitude and longitude values. **If switched Off, the coordinates immediately revert to the Hub's saved location data and will be used on the next scheduled poll or manual polling.**

##### ğŸ¯ Purpose and Use
This setting is essential when the Hubitat Hub's physical location (Latitude and Longitude) is incorrect, or if you wish to monitor pollen data for a different location. It gives the user the ability to switch back and forth between the custom location and the Hub's default location with a single action.

##### ğŸ“Œ Options and Values
| Field Type | Value Range | Default Value |
| :--- | :--- | :--- |
| **Toggle Switch** | On / Off | Off (Use Hub Coordinates) |

When the toggle is **On**, the following three fields become visible for user input:

* **Location Name (Text Input):** A reference field for the user to label the custom location (e.g., "The Cottage," "Vacation Home," "Work"). *This field is optional and not required by the API.*
* **Custom Latitude (Decimal Input):** The north-south position of the custom location.
* **Custom Longitude (Decimal Input):** The east-west position of the custom location.

##### ğŸ’¡ Hints and Best Practices
* **Mandatory Refresh:** After changing this toggle's state or entering new coordinates, you **must close and reopen the device driver page** in the Hubitat interface to display or hide the custom coordinate fields correctly.
* **Validation:** While the input fields will accept any numerical data, the Google Pollen API will only return data if it can resolve the provided latitude and longitude. Using non-relevant or highly inaccurate coordinates will result in errors appearing in the Hubitat Logs and the device's **`apiStatus`** attribute.
* **Multi-Location Setup:** To monitor pollen for two different places (e.g., your Home Hub location and a Cottage), you can install the driver twice, using the custom coordinate option in the second installation.
* **Polling:** Changing the coordinates does **not** automatically trigger a poll. After setting new custom coordinates, you must use the **Poll (Button)** to immediately fetch the new location's forecast data.

#### ğŸš« Use Blockout Dates?

> **Description:** A toggle that allows the user to define an annual period during which the driver is prevented from making *any* calls to the Google Pollen API. This feature helps prevent unnecessary API usage and saves quota during the pollen off-season.

##### ğŸ¯ Purpose and Use
When enabled, the driver temporarily stops all API interactionâ€”this includes all scheduled polls (Primary and Secondary) and prevents manual polling via the **Poll (Button)**. All related Current States will update to reflect that the blockout period is in effect, providing clear user feedback.

##### ğŸ“Œ Options and Values
| Field Type | Value Range | Default Value |
| :--- | :--- | :--- |
| **Toggle Switch** | On / Off | Off |

When the toggle is **On**, the following two fields become visible for user input:

* **Blockout Start Date (Hubitat Date Picker):** The date when the driver should begin blocking API polls.
* **Blockout End Date (Hubitat Date Picker):** The date when the driver should resume normal polling operations.

##### ğŸ’¡ Hints and Best Practices
* **Mandatory Refresh:** After changing this toggle's state or setting the dates, you **must close and reopen the device driver page** in the Hubitat interface to display or hide the date picker fields correctly.
* **Annual Roll-Forward:** This is an automated convenience feature. Once the driver successfully exits an active blockout period, it will automatically calculate and set the new **Blockout Start Date** and **Blockout End Date** one year into the future. This prepares the driver for the next off-season without further manual intervention.
* **Polling Resumption:** If the toggle is switched **Off** while a blockout is active, the driver will immediately use the Hub's scheduler to resume normal polling operations on the next scheduled time.
* **Quota Savings:** This feature is highly recommended for reducing API consumption when you know the monitored pollen are not relevant in your area (e.g., winter months).

---

## ğŸ“ Summary

> ğŸš§ **Documentation Scope:** The detailed explanation for this section is currently being finalized.  
> Please check back in a future Beta release for the complete guide. Thank you for your patience!

---

## ğŸ›¡ï¸ Disclaimers

âš ï¸ Important: Always backup your Hubitat setup and test automation changes incrementally. This repository is intended for educational and experimental purposes only. Professional judgment is required when deploying in your home.

**Provided As-Is:** All drivers and apps in this repository are provided as-is, without any warranty or guarantee of suitability for your particular setup. Use at your own risk.

**User Responsibility:** You assume full responsibility for any automation decisions, device actions, or outcomes resulting from the use of these drivers or apps. Always test in a safe environment before full deployment.

**Google API Usage:** Access to Google APIs (Pollen, Air Quality, Weather) is subject to Googleâ€™s terms of service, quotas, and billing requirements. Ensure compliance and monitor your usage.

**Community-Developed / Non-Affiliation:** This repository is independently developed and maintained. It is not affiliated with Google LLC, Hubitat Inc., or any other company mentioned.

**Information Accuracy:** Development was performed using the best available knowledge and resources at the time. APIs, Hubitat functionality, or integration methods may change over time, potentially affecting functionality.

**AI-Assisted Development:** All drivers were developed with AI assistance. While code has been tested, AI-generated outputs may include quirks, non-standard patterns, or unexpected behavior.

**External Dependencies:** Any third-party libraries, dashboards, or tools referenced are the responsibility of the respective developers. Verify compatibility before integrating.

---

## ğŸ”— Reference / External Links

ğŸ“˜ [Google Pollen API Documentation](https://developers.google.com/pollen)  
ğŸ“˜ [Google Pollen API Supported Countries & Plants](https://www.google.com/search?q=Google+pollen+API+supported+countries+plants)

---

## ğŸ“œ Revision History
| Version | Date       | Author | Changes           |
|---------|------------|--------|-------------------|
| 0.1     | 2025-12-08 | DBQ    | Draft of Document |
